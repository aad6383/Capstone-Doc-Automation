---
- name: Start 4 Ubuntu containers
  hosts: localhost
  # gather facts: false
  tasks:  
    - name: Start Ubuntu Container
      command: docker run -d ubuntu sleep infinity
      register: container
      with_sequence: count=4

    - name: Show container ids
      debug:
        var: item.stdout_lines
      with_items: "{{ container.results }}"

    - name: Get running containers
      docker_host_info:
        containers: yes
        register: docker_info

    - name: Stop running containers
      docker_container:
        name: "{{ item }}"
        state: stopped
      loop: "{{ docker_info.containers | map(attribute = 'Id') | list }}"
